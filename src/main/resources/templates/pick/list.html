<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="layout/layout :: head('PICK')">
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script th:src="@{/js/common.js}"></script>
<body>


<style>
    #naver_blog {
        height: 250px !important;
        padding-top: 80px;
        font-weight: 900;
        font-size: 3rem;
        background: #2db400;
        color: #fff;
        text-align: center;
    }
    .card-body {
        box-shadow: rgb(0 0 0 / 4%) 0px 4px 16px 0px;
    }
</style>

<nav class="bg-dark" th:replace="layout/layout :: menu('PICK')" style="position: fixed; width: 100%;">
</nav>

<div style="background: rgb(248, 249, 250); min-height: calc(100% - 3rem); ">
    <div class="container px-2 py-5" id="custom-cards">

        <div class="d-flex justify-content-between">
            <h2>스터디</h2>

            <form th:action="@{pick}" th:method="GET">
                <div class="d-flex w-100 mx-auto">
                    <input class="form-control" type="text" name="s">&nbsp
                    <button type="submit" class="btn btn-outline-secondary">
                        <i class="fa fa-search"></i>
                    </button>
                </div>
            </form>
        </div>


        <div class="row row-cols-1 row-cols-lg-4 align-items-stretch g-4 py-5">

            <div th:each="pick : ${picks}">
                <div class="col">
                    <div class="card" style="border: none !important;">
                        <div class="card-body p-0">
                            <div th:if="${#strings.substring(pick.url, 0, 22)} == 'https://blog.naver.com'"
                                 id="naver_blog">
                                NAVER BLOG
                            </div>
                            <img th:unless="${#strings.substring(pick.url, 0, 22)} == 'https://blog.naver.com'" class="w-100" style="height: 250px !important;" th:src="${pick.thumbnail}+'?type=w647'" alt="">
<!--                            <img class="w-100" style="height: 250px !important;" th:src="${pick.thumbnail}" alt="">-->

                            <div class="p-2">
                                <h4 class="pb-1 pt-3 m-0" th:text="${pick.title}"></h4>
                                <p class="px-2 fs-6 pb-1">
                                    [[${pick.description}]] ...
                                    <button class="btn btn-outline-danger p-0" style="font-size: .75rem;"
                                            th:onclick="originalPage([[${pick.url}]])">원문보기
                                    </button>
                                </p>

                                <div class="d-flex justify-content-between mt-auto">
                                    <div>
                                        <span class="text-secondary">[[${#temporals.format(pick.createdAt, 'yyyy/MM/dd')}]]</span>
                                    </div>
                                    <div>
                                        <button th:id="'bookMarkBtn_'+${pick.epId}" class="btn p-0 text-secondary" sec:authorize="isAuthenticated()" th:onclick="bookMark([[${pick.epId}]])">
                                            <i th:classappend="${pick.bookMarkId} == null ? 'far fa-bookmark' : 'fa fa-bookmark'" sec:authentication=""></i>
                                            <span>북마크</span>
                                        </button>
                                        <button class="btn p-0 text-secondary" sec:authorize="!isAuthenticated()" th:onclick="noAuth()">
                                            <i class="far fa-bookmark"></i>
                                            <span>북마크</span>

                                        </button>

                                        <!-- modal -->
                                        <button type="button" class="btn p-0 text-secondary" data-bs-toggle="modal" th:data-bs-target="'#ep_'+${pick.epId}" th:onclick="getComments([[${pick.epId}]], [[${#authentication.getName()}]])">
                                            <i class="far fa-comments"></i> <span th:text="${pick.countComments}"></span>
                                        </button>

                                        <div class="modal fade" th:id="'ep_'+${pick.epId}" tabindex="-1" th:aria-labelledby="'ep_l_'+${pick.epId}" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" th:id="'ep_l_'+${pick.epId}">
                                                            <span th:text="${pick.title}"></span>
                                                        </h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body" style="height: 500px; overflow: auto;">
                                                        <div th:id="'m_b_'+${pick.epId}"></div>
                                                    </div>
                                                    <div class="p-2">

                                                        <form th:action="@{/comment/create/ep/{epId}(epId = ${pick.epId})}" th:method="POST">
                                                            <div class="w-100 d-flex">
                                                                <input class="form-control" type="text" name="content" style="width: 90%;">&nbsp;
                                                                <button class="btn btn-outline-dark p-1" style="width: 10%;" type="submit"><span>저장</span></button>
                                                            </div>
                                                        </form>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- modal -->


                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--        -->
        <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-center">

                <li class="page-item" th:classappend="${1 == picks.pageable.pageNumber + 1} ? 'disabled'">
                    <a class="page-link" th:href="@{/pick(page=${picks.pageable.pageNumber - 1}, s=${param.s})}" tabindex="-1" aria-disabled="true"> < </a>
                </li>

                <li class="page-item" th:classappend="${i == picks.pageable.pageNumber + 1} ? 'disabled'" th:each="i : ${#numbers.sequence(startPage, endPage)}">
                    <a class="page-link" th:href="@{/pick(page=${i - 1}, s=${param.s})}" th:text="${i}"></a>
                </li>

                <li class="page-item" th:classappend="${picks.totalPages == picks.pageable.pageNumber + 1} ? 'disabled'">
                    <a class="page-link" th:href="@{/pick(page=${picks.pageable.pageNumber + 1}, s=${param.s})}"> > </a>
                </li>

            </ul>
        </nav>

        <!--        -->
    </div>
</div>

<script>
    function originalPage(_url) {
        window.open(_url);
    }
</script>

<!-- SIDEBAR -->
<div id="sidebar" th:replace="layout/layout :: sidebar('PICK')">
</div>
<!-- // SIDEBAR -->


</body>

</html>